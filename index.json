[{"categories":["Linux"],"content":"解决inode占用过多的方案 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:0:0","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["Linux"],"content":"前情提要： 某台服务器inode满了，很久没有处理过类似问题了，有点忘记，记录在此。 一、理解inode 要理解inode，要从文件存储说起，Linux系统文件在物理上都是存储在硬盘上面的，硬盘存储里面，最小存储单位是\"扇区(Sector)\"，每个扇区存储512字节。 操作系统在读取硬盘的时候不会一个一个读取扇区，这样效率很低，而是一次性连续读取多个扇区，多个扇区就组成了一个块(block)，而这种由多个扇区组成的块，就是文件存储的最小单位，块的大小一般为4KB，也就是说8个扇区组成了一个block。 文件信息存储在block中，如何找到这些block，以及怎么知道这些block存储了哪些内容，如文件的创建人、时间、大小等信息，这些信息又叫元数据，而这种存储元数据的区域就叫做inode，inode就是索引节点。 也就是说每个文件都需要记录这些元信息，也必然会占用inode，因此inode占用过多，多数是小文件太多导致。 二、查找哪里占用inode 查看 / 目录 inode满了，导致服务无法正常重启，并且存在大量的僵尸进程造成内存耗尽，知道了inode占用多是文件多导致之后，那么只需要找到哪些目录下小文件过多，然后删除即可 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:1:0","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["Linux"],"content":"1.查看哪个盘占用inode df -ih df -ia 两个命令均可 top ##查看异常使用进程 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:1:1","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["Linux"],"content":"2.进入该挂载目录，然后通过wc -l统计哪些占用多。 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:1:2","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["Linux"],"content":"3.可以看到是/var/spool/postfix/maildrop下很多小文件 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:1:3","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["Linux"],"content":"4.解决办法：执行以下命令 ps -ef | egrep \"sendmail|postdrop\" | grep -v grep |xargs kill 或者 killall postdrop 查到了/var/spool/postfix/maildrop目录下有大量小文件，原来是crond在执行脚本时，会将保持信息以邮件的形式发送给crond用户，而环境的postfix没有正常运行，导致邮件发送失败，都会堆积在/var/spool/postfix/maildrop/目录中，要解决该问题，一是可以启动postfix，让 邮件服务正常运行.另外还可以在/etc/crontab中修改配置MAILTO=““发送为空，这样就不会堆积了。 \u003c200b\u003e 删除占用inode的文件 find /var/spool/postfix/maildrop/ -type f |xargs rm -rf ps： \u003c200b\u003e 建议正式环境非工作时间操作，避免影响服务器性能。 \u003c200b\u003e 遍历查找数据盘inode占用最多的目录 find /data -xdev -printf '%h\\n' | sort | uniq -c | sort -k 1 -n ## /data 目录根据需求进行替换 ","date":"2021-11-04","objectID":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/:1:4","tags":["操作系统","linux"],"title":"解决inode占用过多的解决方案","uri":"/%E8%A7%A3%E5%86%B3inode%E5%8D%A0%E7%94%A8%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"},{"categories":["通话"],"content":"pbx临时保存wav录音格式文件 ","date":"2021-11-03","objectID":"/pbx%E4%B8%B4%E6%97%B6%E4%BF%9D%E5%AD%98wav%E5%BD%95%E9%9F%B3%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:0:0","tags":["呼叫中心","通话"],"title":"Pbx临时保存wav录音格式文件说明","uri":"/pbx%E4%B8%B4%E6%97%B6%E4%BF%9D%E5%AD%98wav%E5%BD%95%E9%9F%B3%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":["通话"],"content":"用ass合成 1.在server.conf中[server]段内添加需要wav文件的账号： thisAccountNeedWav=N00000000535,N00000001583 多个账号用，(英文逗号)隔开。 2.在server.conf中[server]段内添加wav保存的天数： deleteWavs=3 wav文件比较大，不建议保存太久。 3.reload 一下ass配置文件： (echo “Login -u 用户名 -p 密码”;sleep 1;echo “reload” ;sleep 3)|telnet localhost 7877 4.新加nginx配置文件： location /inOutTempOfWav { root /var/spool/asterisk/; index index.html index.htm; ##以下limit配置必须定义limit参数，否则不予以配置## limit_rate_after 10M; limit_rate 800k; limit_conn monitor_down 10; limit_req zone=monitor_down_1 burst=20 nodelay; } 5.reload nginx配置文件： /opt/nginx/sbin/nginx -s reload 配置完成后让前端运维或客户测试。 ","date":"2021-11-03","objectID":"/pbx%E4%B8%B4%E6%97%B6%E4%BF%9D%E5%AD%98wav%E5%BD%95%E9%9F%B3%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:1:0","tags":["呼叫中心","通话"],"title":"Pbx临时保存wav录音格式文件说明","uri":"/pbx%E4%B8%B4%E6%97%B6%E4%BF%9D%E5%AD%98wav%E5%BD%95%E9%9F%B3%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":["通话"],"content":"sngrep部署文档 ","date":"2021-10-20","objectID":"/my-first-post/:0:0","tags":["呼叫中心","通话","工具"],"title":"My First Post","uri":"/my-first-post/"},{"categories":["通话"],"content":"安装包为：sngrep-1.4.7 ","date":"2021-10-20","objectID":"/my-first-post/:0:1","tags":["呼叫中心","通话","工具"],"title":"My First Post","uri":"/my-first-post/"},{"categories":["通话"],"content":"操作步骤： 建议将安装位置放置在数据盘路径 yum install -y ncurses-devel make libpcap-devel pcre-devel openssl-devel git gcc autoconf automake tar -zxvf sngrep-1.4.7.tar.gz cd sngrep-1.4.7 ./bootstrap.sh ./configure make \u0026\u0026make install 一般报错多为缺少依赖，自行百度查找依赖。yum进行安装就可以 sngrep -c ##进入抓包界面 你可以将以下标志传递给. /configure 以启用某些功能 配置标志功能 –with-openssl 添加OpenSSL支持来解析捕获的消息( 请求。 libssl ) –with-gnutls 添加GnuTLS支持来解析捕获的消息( 请求。 gnutls ) –with-pcre 在正则表达式字段中添加Perl兼容的正规表达式 支持 –enable-unicode 添加 Ncurses/unicode支持( 要求。 libncursesw5 ) –enable-ipv6 启用IPv6数据包捕获支持。 –enable-eep 启用EEP数据包发送/接收支持。 ","date":"2021-10-20","objectID":"/my-first-post/:0:2","tags":["呼叫中心","通话","工具"],"title":"My First Post","uri":"/my-first-post/"},{"categories":["通话"],"content":"sngrep基本参数 -h --help：显示帮助信息 -V --version：显示版本信息 -d --device：指定抓包的网卡 -I --input：从pacp文件中解析sip包 -O --output：输出捕获的包到pacp文件中 -c --calls：仅显示邀请消息 -r --rtp：捕获RTP数据包有效载荷捕获rtp包 -l --limit：限制捕获对话的数量 -i --icase：使大小写不敏感 -v --invert：颠倒（不太明白） -N --no-interface：不显示sngrep界面，仅捕获 -q --quiet：不要在无界面模式下打印捕获的对话框 -D --dump-config：打印活动的配置设置并退出 -f --config：从文件中读取配置 -R --rotate：达到捕获限制时轮换呼叫。 -H --eep-send：荷马sipcapture网址（udp：XXXX：XXXX） -L --eep-listen：监听封装的数据包（udp：XXXX：XXXX） -k --keyfile：RSA私钥文件解密捕获的数据包 抓取INVITE请求的包: sngrep ^INVITE 抓取REGISTER请求的包: sngrep ^REGISTER 抓取OPTIONS请求的包: sngrep ^OPTIONS 捕获端口5060上的所有SIP数据包: sngrep port 5060 使用sngrep查看来自pcap文件的SIP数据包，并使用过滤器: sngrep -I file.pcap host 192.168.1.1 and port 5060 或实时捕获，将数据包保存到新文件: sngrep -d eth0 -O save.pcap port 5060 and udp ","date":"2021-10-20","objectID":"/my-first-post/:0:3","tags":["呼叫中心","通话","工具"],"title":"My First Post","uri":"/my-first-post/"},{"categories":["通话"],"content":"快捷键 • 箭头键：在列表中移动，除上下箭头还可以使用j，k来移动光标 • 输入：显示当前或所选对话框的消息流 • 答：自动滚动到新电话，自动滚动到新的电话 • F2或S：将所选/所有对话框保存到PCAP文件，保存对话框到pacp文件 • F3或/或TAB：输入显示过滤器。该过滤器将应用于列表中的文本行，进入搜索 • F4或x：显示当前选择的对话框和其相关的一个。回到第一个SIP消息上 • F5：清除通话清单，清空通话清单 • F6或r：以原始文本显示所选对话框的消息，显示原始的sip消息 • F7或f：显示高级过滤器对话框显示高级过滤弹窗 • F9或l：如果启用，则打开/关闭地址解析 • F10或t：选择显示的列，显示或隐藏侧边sip消息栏 呼叫列表页面还能够显示两个弹窗，按f可以显示高级过滤配置 ","date":"2021-10-20","objectID":"/my-first-post/:0:4","tags":["呼叫中心","通话","工具"],"title":"My First Post","uri":"/my-first-post/"}]